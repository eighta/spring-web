<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;14.&nbsp;web-test: Functional Web Application Testing</title><link rel="stylesheet" href="css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.70.0"><link rel="start" href="index.html" title="Spring Web Training - Lab Documentation"><link rel="up" href="index.html" title="Spring Web Training - Lab Documentation"><link rel="prev" href="web-security-lab.html" title="Chapter&nbsp;13.&nbsp;web-security: Securing the Web Tier"><link rel="next" href="webflow-actions-lab.html" title="Chapter&nbsp;15.&nbsp;webflow-actions: Adding Actions to Web Flow"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.pivotal.io" title="Pivotal"><img style="border:none;" src="images/heading-logo-lhs.jpg"></img></a><a style="border:none;" href="http://www.spring.io" title="The Spring Framework"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/heading-logo-rhs.jpg"></img></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="web-testing-lab"></a>Chapter&nbsp;14.&nbsp;web-test: Functional Web Application Testing</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-test-lab-introduction"></a>14.1.&nbsp;Introduction</h2></div></div></div><p>
            In this lab you will gain experience creating functional tests using the new MVC Test Framework.        </p><div class="orderedlist"><p class="title"><b>What you will learn:</b></p><ol type="1" compact><li><p>How to create a test harness using the new Spring MVC Test Framework</p></li><li><p>How to create a simple test to verify correct controller functionality and MVC configuration</p></li><li><p>How to create tests that validate data binding and validation</p></li><li><p>How to create a test for RESTful controllers</p></li><li><p>How to perform basic security validation</p></li></ol></div><p>Estimated time to complete: 45 minutes</p><p>URL for this project <a href="http://localhost:8080/web-test" target="_top">
        http://localhost:8080/web-test/</a>.</p><p>Solution URL: <a href="http://localhost:8080/web-test-solution" target="_top">
        http://localhost:8080/web-test-solution/</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-test-lab-simple-instructions"></a>14.2.&nbsp;Quick Instructions</h2></div></div></div><p>Quick instructions for this exercise have been embedded within the lab materials
    in the form of TODO comments.  To display them, open the <code class="literal">Tasks</code> view 
    (Window -&gt; Show view -&gt; Tasks (<span class="emphasis"><em>not Task List</em></span>)).</p><p>Occasionally, TODO'S defined within XML files may fail to appear in 
    the <code class="literal">Tasks</code> view (i.e. gaps in the number sequence).  To correct this, 
    go to <code class="literal">Preferences -&gt; General -&gt; Editors -&gt;
    Structured Text Editor -&gt; Task Tags</code>
    pane.  Check <code class="literal">Enable searching for Task Tags</code> and
    click <code class="literal">Clean and Redetect Tasks</code>.
    On the <code class="literal">Filters</code> tab, ensure XML content type is checked.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-test-lab-instructions"></a>14.3.&nbsp;Detailed Instructions</h2></div></div></div><p>
        This lab will focus on using the MVC Test framework to perform functional
        tests on your controllers and related MVC configuration.  The lab is
        broken into several steps to help you get comfortable with the process
        of setting up and writing functional tests. 
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.setup"></a>14.3.1.&nbsp;Setup an MVC test harness</h3></div></div></div><p>
            To begin, navigate to the web-test project. Notice that there are
            currently two integration tests under the 
            <code class="literal">rewardsonline.accounts</code> package in the
            <code class="filename">src/test/java</code> source folder. Open the
            <code class="classname">AccountControllerIntegrationTests</code> class and perform
            the following steps to properly configure the test harness. 
        </p><div class="orderedlist"><ol type="1"><li><p>Add the appropriate static imports to ensure you have access to
          the <code class="classname">MockMvcRequestBuilder</code> and
          <code class="classname">MockMvcResultMatcher</code> static methods (TODO-01).</p></li><li><p>Add  annotations to the class to define this as a test that will
          include a Spring Application Context. Be sure to provide a reference
          to all of the Spring configuration files
          (<span class="emphasis"><em>except</em></span> <code class="filename">security-config.xml</code>)
          and indicate to use the <code class="classname">WebApplicationContext</code>
          (TODO-02).</p></li><li><p>Define your required dependencies (such as the
          <code class="classname">WebApplicationContext</code> and the
          <code class="classname">AccountManager</code>) as fields of the test harness
          and tell Spring to autowire them in (TODO-03).</p></li><li><p>Finally, define a <code class="classname">MockMvc</code>  instance and
          create a setup method annotated with <code class="classname">@Before</code>
          and write the proper initialization code to initialize the <code class="code">
              <code class="classname">mockMvc</code>
            </code> field using the <code class="classname">WebApplicationContext</code>
            that was injected into the test harness (TODO-04).</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.test_get"></a>14.3.2.&nbsp;Test a simple GET operation on the AccountsController</h3></div></div></div><p>In this step, you will write a simple test to invoke the <code class="classname">AccountsController</code> <code class="code">show()</code> method. Take a moment to inspect this controller to determine what the correct request path would be to invoke that handler method.</p><p>When you are ready to begin, perform the following steps to create your first test case.</p><div class="orderedlist"><ol type="1"><li><p>Use the <code class="literal">mvcMock</code> object to perform an HTTP <code class="literal">GET</code> request to your controller to get account details for account ID '123456001' (TODO-05). Remember, you are performing a get with a specific account number. How would you specify the arguments to the <code class="code">get()</code> method to use the URI template style so you could invoke the controller with any account ID?</p></li><li><p>Next, add an expect statement to verify you get the correct HTTP status code returned from invoking the controller. Run your test so far and verify that the test passes.</p></li><li><p>Once the basic test passes, take a moment to inspect your <code class="classname">AccountsController.show()</code> method and determine what other items you might verify. Potential elements might be a correct number of model attributes added, correct view returned, correct forward/redirect, etc. Don&#8217;t try to add all the tests at once. </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Be sure to refer back to the slides to see different options for setting expectations.</p></td></tr></table></div></li><li><p>As you add each expect, re-run the test to ensure you have the test correct.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.test_post"></a>14.3.3.&nbsp;Test a POST operation on AccountsController</h3></div></div></div><p>Now that you have a basic test in place, you have ensured that your overall test harness is configured properly and you have a basic grasp of the method for performing a request and validating expected responses. In this step, you will write a test to simulate POST&#8217;ing data from a form to ensure proper binding. There is a method on the <code class="classname">AccountsController</code> that processes a <code class="literal">POST</code> request with form data. Take a moment to locate that method and determine the correct invocation URL. </p><p>Use the following steps to set up this test (TODO-06).</p><div class="orderedlist"><ol type="1"><li><p>Create a new test method that performs the appropriate request on the <code class="code">mockMvc</code> object in order to be routed to the correct handler method on the <code class="classname">AccountsController</code></p></li><li><p>Add request parameters to the invocation to simulate the items submitted from the form page. Be sure to format all parameters as they will look when submitted as HTTP form parameters.</p></li><li><p>Add appropriate expect statements to reflect the behavior of the controller on a successful update. This would include getting a 302 status code returned (due to the redirect) and having the correct redirect URL returned.</p></li><li><p>Re-run the tests making necessary corrections until all tests pass</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.test_validation"></a>14.3.4.&nbsp;Test Validation</h3></div></div></div><p>In this step, you will create a scenario where validation is designed to fail. Take a moment and review the arguments to the <code class="classname">AccountsController.save()</code> method. Notice the presence of the <code class="classname">@Valid</code> annotation, which will trigger a validation step. Next, open the <code class="classname">Account</code> class and observe the various validation annotations. In particular, observe the validation for the email property. </p><p>This pattern asserts that any string on this property much match the specified pattern. In the prior step, you should have provided a valid email. This time, you will create an invalid email and assert that validation does indeed fail (TODO-07).</p><div class="orderedlist"><ol type="1"><li><p>Create a new test method that is very similar to the previous one in that you invoke the same URL with a <code class="literal">POST</code> request and provide parameters to the request. However, this time be sure to specify an email address that is invalid.</p></li><li><p>There are a number of different ways to validate that the model failed expectations. Play around with a couple of these to get comfortable with them. Be sure to review the slides to get some ideas on how to assert model errors.</p></li><li><p>Finally, add some expectations for HTTP status code and forwarded URL based on a failed validation.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.test_rest"></a>14.3.5.&nbsp;Write a test to exercise a RESTful controller method</h3></div></div></div><p>In this step, you will write a test to exercise the one RESTful handler method on the <code class="classname">AccountsController</code>. Take a moment to evaluate the <code class="code">accountDetails()</code> method and determine the necessary parameter(s) and invocation style.</p><p>Write the test to properly invoke the method, requesting content to be returned as JSON representation (TODO-08).</p><div class="orderedlist"><ol type="1"><li><p>Make sure to request a request a content type of "application/json"</p></li><li><p>Assert that the returned result is indeed "application/json"</p></li><li><p>Write an assertion for the JSON content returned to assert values for creditCardNumber using JsonPath expressions. Review the slides or visit https://code.google.com/p/json-path/ to get some ideas.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="details.test_security"></a>14.3.6.&nbsp;Bonus: Write a security test scenario</h3></div></div></div><p>In this last optional step, you will have a chance to write some tests to validate your security configuration. You will also gain experience accessing and registering a filter with the <code class="code">mockMvc</code> object.</p><p>Browse to the Spring configuration files under
      <code class="filename">src/main/webapp/WEB-INF/spring</code> and notice the additional
      <code class="filename">security-config.xml</code> file. Recall from the Security module
      that the security &lt;http&gt; tag causes the
      <code class="classname">FilterChainProxy</code> class to be instantiated and registered
      under the name <code class="code">springSecurityFilterChain</code>. This is what we need to
      do now.</p><div class="orderedlist"><ol type="1"><li><p>Begin by editing the <code class="classname">AccountControllerSecurityTests</code>
          class and adding the necessary static imports to use the
          <code class="classname">MockResultBuilder</code> and
          <code class="classname">MockResultMatcher</code> static methods (TODO-09) </p></li><li><p>Next add the appropriate annotations to the class to make it 
          Spring aware, load the Spring configuration files and create a
          <code class="classname">WebApplicationContext</code> (TODO-10)</p></li><li><p>Autowire in an instance of <code class="classname">WebApplicationContext</code> and the <code class="classname">FilterchainProxy</code> (TODO-11).</p></li><li><p>Finish the setup method initialization by initializing the <code class="code">mockMvc</code> object and registering  the <code class="code">FilterChainProxy</code> filter instance in the process (TODO-12). If you are unsure how to do this, review the slides again.</p></li><li><p>Next, write a test that asserts that on invoking any path that is protected that you are redirected to the login page (TODO-13). If you are unsure of what this page is, go back and review your security configuration. Run the test. When the test passes, you have completed this step.</p></li></ol></div><p>Congratulations, you have completed this lab!</p></div></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="web-security-lab.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="webflow-actions-lab.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;web-security: Securing the Web Tier&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.spring.io" title="The Spring Framework">Spring By Pivotal</a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;15.&nbsp;webflow-actions: Adding Actions to Web Flow</td></tr></table></div></body></html>